(function(a){var b;define([],function(){return function(){(function(){var a,b="https://api.github.com";a=window.Github=function(c){function d(a,d,e,f,g){function h(){var a=b+d;return a+(/\?/.test(a)?"&":"?")+(new Date).getTime()}var i=new XMLHttpRequest;g||(i.dataType="json"),i.open(a,h()),i.onreadystatechange=function(){this.readyState==4&&(this.status>=200&&this.status<300||this.status===304?f(null,g?this.responseText:this.responseText?JSON.parse(this.responseText):!0):f({request:this,error:this.status}))},i.setRequestHeader("Accept","application/vnd.github.raw"),i.setRequestHeader("Content-Type","application/json"),(c.auth=="oauth"&&c.token||c.auth=="basic"&&c.username&&c.password)&&i.setRequestHeader("Authorization",c.auth=="oauth"?"token "+c.token:"Basic "+Base64.encode(c.username+":"+c.password)),e?i.send(JSON.stringify(e)):i.send()}a.User=function(){this.repos=function(a){d("GET","/user/repos?type=all&per_page=1000&sort=updated",null,function(b,c){a(b,c)})},this.orgs=function(a){d("GET","/user/orgs",null,function(b,c){a(b,c)})},this.gists=function(a){d("GET","/gists",null,function(b,c){a(b,c)})},this.show=function(a,b){d("GET","/users/"+a,null,function(a,c){b(a,c)})},this.userRepos=function(a,b){d("GET","/users/"+a+"/repos?type=all&per_page=1000&sort=updated",null,function(a,c){b(a,c)})},this.userGists=function(a,b){d("GET","/users/"+a+"/gists",null,function(a,c){b(a,c)})},this.orgRepos=function(a,b){d("GET","/orgs/"+a+"/repos?type=all&per_page=1000&sort=updated&direction=desc",null,function(a,c){b(a,c)})}},a.Repository=function(a){function b(a,b){if(a===h.branch&&h.sha)return b(null,h.sha);f.getRef("heads/"+a,function(c,d){h.branch=a,h.sha=d,b(c,d)})}var c=a.name,e=a.user,f=this,g="/repos/"+e+"/"+c,h={branch:null,sha:null};this.getRef=function(a,b){d("GET",g+"/git/refs/"+a,null,function(a,c){if(a)return b(a);b(null,c.object.sha)})},this.createRef=function(a,b){d("POST",g+"/git/refs",a,b)},this.deleteRef=function(b,c){d("DELETE",g+"/git/refs/"+b,a,c)},this.listBranches=function(a){d("GET",g+"/git/refs/heads",null,function(b,c){if(b)return a(b);a(null,_.map(c,function(a){return _.last(a.ref.split("/"))}))})},this.getBlob=function(a,b){d("GET",g+"/git/blobs/"+a,null,b,"raw")},this.getSha=function(a,b,c){if(b==="")return f.getRef("heads/"+a,c);f.getTree(a+"?recursive=true",function(a,d){var e=_.select(d,function(a){return a.path===b})[0];c(null,e?e.sha:null)})},this.getTree=function(a,b){d("GET",g+"/git/trees/"+a,null,function(a,c){if(a)return b(a);b(null,c.tree)})},this.postBlob=function(a,b){typeof a=="string"&&(a={content:a,encoding:"utf-8"}),d("POST",g+"/git/blobs",a,function(a,c){if(a)return b(a);b(null,c.sha)})},this.updateTree=function(a,b,c,e){var f={base_tree:a,tree:[{path:b,mode:"100644",type:"blob",sha:c}]};d("POST",g+"/git/trees",f,function(a,b){if(a)return e(a);e(null,b.sha)})},this.postTree=function(a,b){d("POST",g+"/git/trees",{tree:a},function(a,c){if(a)return b(a);b(null,c.sha)})},this.commit=function(b,c,e,f){var i={message:e,author:{name:a.username},parents:[b],tree:c};d("POST",g+"/git/commits",i,function(a,b){h.sha=b.sha;if(a)return f(a);f(null,b.sha)})},this.updateHead=function(a,b,c){d("PATCH",g+"/git/refs/heads/"+a,{sha:b},function(a,b){c(a)})},this.show=function(a){d("GET",g,null,a)},this.contents=function(a,b){d("GET",g+"/contents",{path:a},b)},this.fork=function(a){d("POST",g+"/forks",null,a)},this.createPullRequest=function(a,b){d("POST",g+"/pulls",a,b)},this.read=function(a,b,c){f.getSha(a,b,function(a,b){if(!b)return c("not found",null);f.getBlob(b,function(a,d){c(a,d,b)})})},this.remove=function(a,c,d){b(a,function(b,e){f.getTree(e+"?recursive=true",function(b,g){var h=_.reject(g,function(a){return a.path===c});_.each(h,function(a){a.type==="tree"&&delete a.sha}),f.postTree(h,function(b,g){f.commit(e,g,"Deleted "+c,function(b,c){f.updateHead(a,c,function(a){d(a)})})})})})},this.move=function(a,c,d,e){b(a,function(b,g){f.getTree(g+"?recursive=true",function(b,h){_.each(h,function(a){a.path===c&&(a.path=d),a.type==="tree"&&delete a.sha}),f.postTree(h,function(b,d){f.commit(g,d,"Deleted "+c,function(b,c){f.updateHead(a,c,function(a){e(a)})})})})})},this.write=function(a,c,d,e,g){b(a,function(b,h){if(b)return g(b);f.postBlob(d,function(b,d){if(b)return g(b);f.updateTree(h,c,d,function(b,c){if(b)return g(b);f.commit(h,c,e,function(b,c){if(b)return g(b);f.updateHead(a,c,g)})})})})}},a.Gist=function(a){var b=a.id,c=this,e="/gists/"+b;this.read=function(a){d("GET",e,null,function(b,c){a(b,c)})},this.delete=function(a){d("DELETE",e,null,function(b,c){a(b,c)})},this.fork=function(a){d("POST",e+"/fork",null,function(b,c){a(b,c)})},this.update=function(a,b){d("PATCH",e,a,function(a,c){b(a,c)})}},this.getRepo=function(b,c){return new a.Repository({user:b,name:c})},this.getUser=function(){return new a.User},this.getGist=function(b){return new a.Gist({id:b})}}}).call(this)}.call(a),b})})(this)